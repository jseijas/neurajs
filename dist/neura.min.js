!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.neura=t()}}(function(){return function t(e,i,r){function s(h,n){if(!i[h]){if(!e[h]){var o="function"==typeof require&&require;if(!n&&o)return o(h,!0);if(a)return a(h,!0);var l=new Error("Cannot find module '"+h+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[h]={exports:{}};e[h][0].call(u.exports,function(t){var i=e[h][1][t];return s(i?i:t)},u,u.exports,t,e,i,r)}return i[h].exports}for(var a="function"==typeof require&&require,h=0;h<r.length;h++)s(r[h]);return s}({1:[function(t,e,i){e.exports={Utils:t("./utils"),Serializable:t("./serializable"),Layer:t("./layer"),Volume:t("./volume"),ActivationLayer:t("./layers/activation_layer"),ConvolutionalLayer:t("./layers/convolutional_layer"),DropoutLayer:t("./layers/dropout_layer"),FullyConnectedLayer:t("./layers/fully_connected_layer"),InputLayer:t("./layers/input_layer"),LinearLayer:t("./layers/linear_layer"),LRNLayer:t("./layers/lrn_layer"),MaxoutLayer:t("./layers/maxout_layer"),ParentedLayer:t("./layers/parented_layer"),PoolLayer:t("./layers/pool_layer"),RegresionLayer:t("./layers/regression_layer"),ReluLayer:t("./layers/relu_layer"),SigmoidLayer:t("./layers/sigmoid_layer"),SoftmaxLayer:t("./layers/softmax_layer"),SVMLayer:t("./layers/svm_layer"),TanhLayer:t("./layers/tanh_layer"),VectorLayer:t("./layers/vector_layer"),Net:t("./net"),Trainer:t("./trainer")}},{"./layer":2,"./layers/activation_layer":3,"./layers/convolutional_layer":4,"./layers/dropout_layer":5,"./layers/fully_connected_layer":6,"./layers/input_layer":7,"./layers/linear_layer":8,"./layers/lrn_layer":9,"./layers/maxout_layer":10,"./layers/parented_layer":11,"./layers/pool_layer":12,"./layers/regression_layer":13,"./layers/relu_layer":14,"./layers/sigmoid_layer":15,"./layers/softmax_layer":16,"./layers/svm_layer":17,"./layers/tanh_layer":18,"./layers/vector_layer":19,"./net":20,"./serializable":21,"./trainer":22,"./utils":23,"./volume":24}],2:[function(t,e,i){const r=t("./serializable");class s extends r{constructor(t){super(),t=t||{},this.parent=t.parent,this.width=t.width||t.out_sx||t.sx||t.width||1,this.height=t.height||t.out_sy||t.sy||t.height||1,this.depth=t.depth||t.out_depth||t.depth||0,console.log(`Creating layer of type: ${this.getLayerType()}`)}forward(){return this.volume=this.parent.volume,this.volume}backward(){}getParamsAndGrads(){var t=[];if(this.filters){for(var e=0;e<this.depth;e+=1)t.push({params:this.filters[e].w,grads:this.filters[e].dw,l1_decay_mul:this.l1_decay_mul,l2_decay_mul:this.l2_decay_mul});t.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0})}return t}getLayerType(){return this.getClassName().slice(0,-5)}getSize(){return this.width*this.height*this.depth}}e.exports=s},{"./serializable":21}],3:[function(t,e,i){const r=t("./parented_layer");class s extends r{forward(t){this.volume||(this.volume=this.parent.volume.cloneAndZero());const e=this.getSize();for(var i=0;i<e;i+=1)this.volume.w[i]=this.activationFunction(this.parent.volume.w[i]);return this.volume}backward(){const t=this.parent.volume.w.length;for(var e=0;e<t;e+=1)this.parent.volume.dw[e]=this.getBackwardGradient(this.parent.volume.w[e],this.volume.w[e],this.volume.dw[e])}}e.exports=s},{"./parented_layer":11}],4:[function(t,e,i){const r=t("../layer"),s=t("../volume"),a=t("../utils");class h extends r{constructor(t){super(t),t=t||{},this.depth=t.filters,this.horizontalFilterSize=t.horizontalFilterSize||t.filterSize||t.sx,this.verticalFilterSize=t.verticalFilterSize||t.filterSize||t.sy||this.horizontalFilterSize,this.stride=t.stride||1,this.pad=t.pad||0,this.l1_decay_mul=t.l1_decay_mul||0,this.l2_decay_mul=t.l2_decay_mul||1,this.width=Math.floor((this.parent.width+2*this.pad-this.horizontalFilterSize)/this.stride+1),this.height=Math.floor((this.parent.height+2*this.pad-this.verticalFilterSize)/this.stride+1);var e=t.bias_pref||0;this.filters=[];for(var i=0;i<this.depth;i++)this.filters.push(new s(this.horizontalFilterSize,this.verticalFilterSize,this.parent.depth));this.biases=new s(1,1,this.depth,e)}forward(){var t,e,i,r,a,h,n=this.parent.volume;for(this.volume||(this.volume=new s(this.width,this.height,this.depth,0)),t=0;t<this.depth;t+=1){var o,l=this.filters[t],u=this.biases.w[t],d=-this.pad;for(e=0;e<this.height;e+=1){for(o=-this.pad,i=0;i<this.width;i+=1){var f=u;for(r=0;r<l.height;r+=1){var c=d+r;if(c>=0&&c<n.height)for(a=0;a<l.width;a+=1){var y=o+a;if(y>=0&&y<n.width)for(h=0;h<l.depth;h+=1)f+=l.w[(l.width*r+a)*l.depth+h]*n.w[(n.width*c+y)*n.depth+h]}}this.volume.set(i,e,t,f),o+=this.stride}d+=this.stride}}return this.volume}backward(){var t=this.parent.volume;t.dw=a.zeros(t.w.length);for(var e=0;e<this.depth;e+=1)for(var i,r=this.filters[e],s=-this.pad,h=0;h<this.height;h+=1){i=-this.pad;for(var n=0;n<this.width;n+=1){var o=this.volume.get_grad(n,h,e);this.biases.dw[e]+=o;for(var l=0;l<r.height;l+=1){var u=s+l;if(u>=0&&u<t.height)for(var d=0;d<r.width;d+=1){var f=i+d;if(f>=0&&f<t.width)for(var c=0;c<r.depth;c+=1){var y=(t.width*u+f)*t.depth+c,p=(r.width*l+d)*r.depth+c;r.dw[p]+=t.w[y]*o,t.dw[y]+=r.w[p]*o}}}i+=this.stride}s+=this.stride}}}e.exports=h},{"../layer":2,"../utils":23,"../volume":24}],5:[function(t,e,i){const r=t("./parented_layer"),s=t("../utils");class a extends r{constructor(t){super(t),t=t||{},this.drop_prob=t.drop_prob||.5,this.dropped=s.zeros(this.getSize())}forward(t=!1){this.volume=this.parent.volume.clone();var e=this.parent.getSize();if(t)for(var i=0;i<e;i+=1)this.dropped[i]=Math.random()<this.drop_prob,this.dropped[i]&&(this.volume.w[i]=0);else for(var i=0;i<e;i+=1)this.volume.w[i]*=1-this.drop_prob;return this.volume}backward(){var t=this.parent.volume,e=t.w.length;t.dw=s.zeros(e);for(var i=0;i<e;i+=1)this.dropped[i]||(t.dw[i]=this.volume.dw[i])}}e.exports=a},{"../utils":23,"./parented_layer":11}],6:[function(t,e,i){const r=t("./vector_layer"),s=t("../volume"),a=t("../utils");class h extends r{constructor(t){super(t),t=t||{},this.depth=t.num_neurons||t.filters||1,this.l1_decay_mul=t.l1_decay_mul||0,this.l2_decay_mul=t.l2_decay_mul||1,this.biases=new s(1,1,this.depth,t.bias_pref||0),this.filters=[];for(var e=0;e<this.depth;e+=1)this.filters.push(new s(1,1,this.num_inputs))}forward(){var t=this.parent.volume;this.volume||(this.volume=new s(1,1,this.depth,0));for(var e=0;e<this.depth;e+=1){for(var i=0,r=this.filters[e].w,a=0;a<this.num_inputs;a+=1)i+=t.w[a]*r[a];i+=this.biases.w[e],this.volume.w[e]=i}return this.volume}backward(){var t=this.parent.volume;t.dw=a.zeros(t.w.length);for(var e=0;e<this.depth;e+=1){for(var i=this.filters[e],r=this.volume.dw[e],s=0;s<this.num_inputs;s+=1)t.dw[s]+=i.w[s]*r,i.dw[s]+=t.w[s]*r;this.biases.dw[e]+=r}}}e.exports=h},{"../utils":23,"../volume":24,"./vector_layer":19}],7:[function(t,e,i){const r=t("../layer");class s extends r{constructor(t){super(t)}inputVolume(t){this.parent={volume:t}}}e.exports=s},{"../layer":2}],8:[function(t,e,i){const r=t("./activation_layer");class s extends r{activationFunction(t){return t}getBackwardGradient(t,e,i){return i}}e.exports=s},{"./activation_layer":3}],9:[function(t,e,i){const r=t("./parented_layer"),s=t("../utils");class a extends r{constructor(t){super(t),t=t||{},this.k=t.k,this.n=t.n,this.n2=Math.floor(this.n/2),this.alpha=t.alpha,this.beta=t.beta}forward(){var t=this.parent.volume;this.volume=t.cloneAndZero(),this.volumeCache=t.cloneAndZero();for(var e=0;e<t.sx;e+=1)for(var i=0;i<t.sy;i+=1)for(var r=0;r<t.depth;r+=1){for(var s=0,a=Math.max(0,r-this.n2),h=Math.min(r+this.n2,t.depth-1),n=a;n<=h;n+=1){var o=t.get(e,i,n);s+=o*o}s=s*(this.alpha/this.n)+this.k,this.volumeCache.set(e,i,r,s),this.volume.set(e,i,r,t.get(e,i,r)/Math.pow(s,this.beta))}return this.volume}backward(){var t=this.parent.volume;t.dw=s.zeros(t.w.length);for(var e=0;e<t.sx;e+=1)for(var i=0;i<t.sy;i+=1)for(var r=0;r<t.depth;r+=1)for(var a=this.volume.get_grad(e,i,r),h=this.volumeCache.get(e,i,r),n=Math.pow(h,this.beta),o=n*n,l=Math.max(0,r-this.n2),u=Math.min(r+this.n2,t.depth-1),d=l;d<=u;d+=1){var f=t.get(e,i,d),c=-f*this.beta*Math.pow(h,this.beta-1)*this.alpha/this.n*2*f;d===r&&(c+=n),c/=o,c*=a,t.add_grad(e,i,d,c)}}}e.exports=a},{"../utils":23,"./parented_layer":11}],10:[function(t,e,i){const r=t("./parented_layer"),s=t("../volume"),a=t("../utils");class h extends r{constructor(t){super(t),t=t||{},this.group_size=t.group_size||2,this.depth=Math.floor(this.parent.depth/this.group_size),this.switches=a.zeros(this.getSize())}forward(){var t=this.parent.volume;this.volume=new s(this.width,this.height,this.depth,0);for(var e=0,i=0;i<t.sx;i+=1)for(var r=0;r<t.sy;r+=1)for(var a=0;a<this.depth;a+=1){for(var h=a*this.group_size,n=t.get(i,r,h),o=0,l=1;l<this.group_size;l+=1){var u=t.get(i,r,h+l);u>n&&(n=u,o=l)}this.volume.set(i,r,a,n),this.switches[e]=h+o,e+=1}return this.volume}backward(){var t=this.parent.volume;t.dw=a.zeros(t.w.length);for(var e=0,i=0;i<this.volume.sx;i+=1)for(var r=0;r<this.volume.sy;r+=1)for(var s=0;s<this.depth;s+=1)t.set_grad(i,r,this.switches[e],this.volume.get_grad(i,r,s)),e++}}e.exports=h},{"../utils":23,"../volume":24,"./parented_layer":11}],11:[function(t,e,i){const r=t("../layer");class s extends r{constructor(t){super(t),this.width=this.parent.width,this.height=this.parent.height,this.depth=this.parent.depth}}e.exports=s},{"../layer":2}],12:[function(t,e,i){const r=t("../layer"),s=t("../volume");class a extends r{constructor(t){super(t),t=t||{},this.sx=t.sx,this.sy=t.sy||this.sx,this.stride=t.stride||2,this.pad=t.pad||0,this.depth=this.parent.depth,this.width=Math.floor((this.parent.width+2*this.pad-this.sx)/this.stride+1),this.height=Math.floor((this.parent.height+2*this.pad-this.sy)/this.stride+1),this.switch=[];for(var e=this.getSize(),i=0;i<e;i++)this.switch.push({x:-1,y:-1})}forward(t){this.volume?this.volume.clear():this.volume=new s(this.width,this.height,this.depth,0);for(var e=0,i=0;i<this.depth;i+=1)for(var r,a=-this.pad,h=0;h<this.width;h+=1){r=-this.pad;for(var n=0;n<this.height;n+=1){for(var o={},l=0;l<this.sx;l+=1){var u=a+l;if(u>=0&&u<this.parent.volume.width)for(var d=0;d<this.sy;d+=1){var f=r+d;if(f>=0&&f<this.parent.volume.height){var c=this.parent.volume.get(u,f,i);(void 0===o.value||c>o.value)&&(o.value=c,o.x=u,o.y=f)}}}this.switch[e].x=a,this.switch[e].y=r,e+=1,this.volume.set(h,n,i,o.value),r+=this.stride}a+=this.stride}return this.volume}backward(){this.parent.volume.clearGrads();for(var t=0,e=0;e<this.depth;e+=1)for(var i=0;i<this.width;i+=1)for(var r=0;r<this.width;r+=1)this.parent.volume.add_grad(this.switch[t].x,this.switch[t].y,e,this.volume.get_grad(i,r,e)),t+=1}}e.exports=a},{"../layer":2,"../volume":24}],13:[function(t,e,i){const r=t("./vector_layer");class s extends r{backward(t){var e=this.parent.volume;e.dw=Utils.zeros(e.w.length);var i=0,r=this.depth;"number"==typeof t&&(t=[t],r=1);for(var s=0;s<r;s+=1){var a=e.w[s]-t[s];e.dw[s]=a,i+=.5*a*a}return i}}e.exports=s},{"./vector_layer":19}],14:[function(t,e,i){const r=t("./activation_layer");class s extends r{activationFunction(t){return t<0?0:t}getBackwardGradient(t,e,i){return e<=0?0:i}}e.exports=s},{"./activation_layer":3}],15:[function(t,e,i){const r=t("./activation_layer");class s extends r{activationFunction(t){return 1/(1+Math.exp(-t))}getBackwardGradient(t,e,i){return e*(1-e)*i}}e.exports=s},{"./activation_layer":3}],16:[function(t,e,i){const r=t("./vector_layer"),s=t("../volume"),a=t("../utils");class h extends r{forward(){var t=this.parent.volume.w;this.volume?this.volume.clear():this.volume=new s(1,1,this.depth,0);for(var e=t[0],i=1;i<this.depth;i+=1)t[i]>e&&(e=t[i]);this.es||(this.es=a.zeros(this.depth));for(var r=0,i=0;i<this.depth;i+=1)this.es[i]=Math.exp(t[i]-e),r+=this.es[i];for(var i=0;i<this.depth;i+=1)this.es[i]/=r,this.volume.w[i]=this.es[i];return this.volume}backward(t){this.parent.volume.clearGrads();for(var e=0;e<this.depth;e+=1)this.parent.volume.dw[e]=this.es[e]-(e===t?1:0);return-Math.log(this.es[t])}}e.exports=h},{"../utils":23,"../volume":24,"./vector_layer":19}],17:[function(t,e,i){const r=t("./vector_layer");class s extends r{backward(t){for(var e=this.parent.volume.w[t],i=0,r=0;r<this.depth;r+=1)if(t!==r){var s=this.parent.volume[r]-e+1;s>0&&(this.parent.volume.dw[r]+=1,this.parent.volume.dw[t]-=1,i+=s)}return i}}e.exports=s},{"./vector_layer":19}],18:[function(t,e,i){const r=t("./activation_layer");class s extends r{activationFunction(t){return Math.tanh(t)}getBackwardGradient(t,e,i){return(1-e*e)*i}}e.exports=s},{"./activation_layer":3}],19:[function(t,e,i){const r=t("../layer");class s extends r{constructor(t){super(t),t=t||{},this.width=1,this.height=1,this.num_inputs=this.parent.getSize(),this.depth=this.num_inputs}}e.exports=s},{"../layer":2}],20:[function(t,e,i){const r=t("./layers/convolutional_layer"),s=t("./layers/dropout_layer"),a=t("./layers/fully_connected_layer"),h=t("./layers/input_layer"),n=t("./layers/linear_layer"),o=t("./layers/lrn_layer"),l=t("./layers/maxout_layer"),u=t("./layers/pool_layer"),d=t("./layers/regression_layer"),f=t("./layers/relu_layer"),c=t("./layers/sigmoid_layer"),y=t("./layers/softmax_layer"),p=t("./layers/svm_layer"),m=t("./layers/tanh_layer");class v{constructor(){this.layers=[],this.layerClasses={},this.registerLayers()}registerLayer(t,e){this.layerClasses[t]=e}registerLayers(){this.registerLayer("conv",r),this.registerLayer("dropout",s),this.registerLayer("fc",a),this.registerLayer("input",h),this.registerLayer("linear",n),this.registerLayer("lrn",o),this.registerLayer("maxout",l),this.registerLayer("pool",u),this.registerLayer("regression",d),this.registerLayer("relu",f),this.registerLayer("sigmoid",c),this.registerLayer("softmax",y),this.registerLayer("svm",p),this.registerLayer("tanh",m)}createLayer(t){return new this.layerClasses[t.type](t)}addLayer(t){if("softmax"===t.type||"svm"===t.type||"regression"===t.type?this.addLayer({type:"fc",num_neurons:t.num_classes||t.num_neurons}):"fc"!==t.type&&"conv"!==t.type||void 0!==t.bias_pref||(t.bias_pref="relu"===t.activation?.1:0),t.parent=this.layers.length>0?this.layers[this.layers.length-1]:void 0,this.layers.push(this.createLayer(t)),t.activation){let e={type:t.activation};"maxout"===t.activation&&(e.group_size=t.group_size||2),this.addLayer(e)}t.drop_prob&&"dropout"!==t.type&&this.addLayer({type:"dropout",drop_prob:t.drop_prob})}makeLayers(t){this.layers=[];for(var e=0;e<t.length;e+=1)this.addLayer(t[e])}getInputLayer(){return this.layers[0]}forward(t,e=!1){this.layers[0].inputVolume(t);for(var i=0;i<this.layers.length;i+=1)this.layers[i].forward(e);return this.layers[this.layers.length-1].volume}backward(t){const e=this.layers[this.layers.length-1].backward(t);for(var i=this.layers.length-2;i>=0;i-=1)this.layers[i].backward();return e}getPrediction(){let t=this.layers[this.layers.length-1].volume.w,e=t[0],i=0;for(var r=1;r<t.length;r+=1)t[r]>e&&(e=t[r],i=r);return i}getParamsAndGrads(){for(var t=[],e=0;e<this.layers.length;e+=1)for(var i=this.layers[e].getParamsAndGrads(),r=0;r<i.length;r+=1)t.push(i[r]);return t}}e.exports=v},{"./layers/convolutional_layer":4,"./layers/dropout_layer":5,"./layers/fully_connected_layer":6,"./layers/input_layer":7,"./layers/linear_layer":8,"./layers/lrn_layer":9,"./layers/maxout_layer":10,"./layers/pool_layer":12,"./layers/regression_layer":13,"./layers/relu_layer":14,"./layers/sigmoid_layer":15,"./layers/softmax_layer":16,"./layers/svm_layer":17,"./layers/tanh_layer":18}],21:[function(t,e,i){class r{clone(){}assign(){}toJSON(){return JSON.stringify(this.clone(!0))}fromJSON(t){this.assign(JSON.parse(t,!0))}getClassName(){return this.constructor.name}}e.exports=r},{}],22:[function(t,e,i){const r=t("./utils");class s{constructor(t,e){this.net=t,e=e||{},this.learning_rate=e.learning_rate||.01,this.l1_decay=e.l1_decay||0,this.l2_decay=e.l2_decay||0,this.batch_size=e.batch_size||1,this.methodName=e.method||"sgd",this.momentum=e.momentum||.9,this.ro=e.ro||.95,this.eps=e.eps||1e-6,this.iteration=0,this.gsum=[],this.xsum=[],this.initializeMethods()}initializeMethods(){this.methods={},this.methods.adam=this.adamMethod.bind(this),this.methods.adagrad=this.adagradMethod.bind(this),this.methods.windowgrad=this.windowgradMethod.bind(this),this.methods.adadelta=this.adadeltaMethod.bind(this),this.methods.nesterov=this.nesterovMethod.bind(this),this.methods.sgd=this.sgdMethod.bind(this)}getMethod(){return this.methods[this.methodName]||this.methods.sgd}adamMethod(t,e,i){var r=this.gsum[t],s=this.xsum[t];r[e]=r[e]*this.beta1+(1-this.beta1)*i,s[e]=s[e]*this.beta2+(1-this.beta2)*i*i;var a=r[e]/(1-Math.pow(this.beta1,this.iteration)),h=s[e]/(1-Math.pow(this.beta2,this.iteration));return-this.learning_rate*a/(Math.sqrt(h)+this.eps)}adagradMethod(t,e,i){var r=this.gsum[t];return r[e]=r[e]+i*i,this.learning_rate/Math.sqrt(r[e]+this.eps)*i}windowgradMethod(t,e,i){var r=this.gsum[t];return r[e]=this.ro*r[e]+(1-this.ro)*i*i,this.learning_rate/Math.sqrt(r[e]+this.eps)*i}adadeltaMethod(t,e,i){var r=this.gsum[t],s=this.xsum[t];r[e]=this.ro*r[e]+(1-this.ro)*i*i;var a=-Math.sqrt((s[e]+this.eps)/(r[e]+this.eps))*i;return s[e]=this.ro*s[e]+(1-this.ro)*a*a,a}nesterovMethod(t,e,i){var r=this.gsum[t];return r[e]=r[e]*this.momentum+this.learning_rate*i,this.momentum*r[e]-(1+this.momentum)*r[e]}sgdMethod(t,e,i){return this.momentum>0?(dx=this.momentum*gsumi[e]-this.learning_rate*i,gsumi[e]=dx,dx):-this.learning_rate*i}propagate(t,e,i){let r=performance.now();this.net.forward(t,!0),i.fwd_time=performance.now()-r,r=performance.now(),i.cost_loss=this.net.backward(e),i.bwd_time=performance.now()-r}initializeSums(t){const e="adadelta"===this.methodName||"adam"===this.methodName;if(0===this.gsum.length&&("sgd"!=this.methodName||this.momentum>0))for(var i=0;i<t.length;i+=1)this.gsum.push(r.zeros(t[i].params.length)),e&&this.xsum.push(r.zeros(t[i].params.length))}iterate(t,e,i){for(var r=0;r<t.length;r+=1)for(var s=t[r],a=s.params,h=s.grads,n=this.l1_decay*(s.l1_decay_mul||1),o=this.l2_decay*(s.l2_decay_mul||1),l=a.length,u=0;u<l;u+=1){i.l1_decay_loss+=n*Math.abs(a[u]),i.l2_decay_loss+=o*a[u]*a[u]/2;var d=(n*(a[u]>0?1:-1)+o*a[u]+h[u])/this.batch_size;a[u]+=e(r,u,d),h[u]=0}}train(t,e){var i={l1_decay_loss:0,l2_decay_loss:0};this.propagate(t,e,i);var r=this.getMethod();if(this.iteration+=1,this.iteration%this.batch_size==0){var s=this.net.getParamsAndGrads();this.initializeSums(s),this.iterate(s,r,i)}return i.loss=i.cost_loss+i.l1_decay_loss+i.l2_decay_loss,i}}e.exports=s},{"./utils":23}],23:[function(t,e,i){class r{static gaussRandom(){if(r.gaussRandomReturnV)return r.gaussRandomReturnV=!1,r.gaussRandomVValue;let t,e,i=0;for(;0===i||i>1;)t=2*Math.random()-1,e=2*Math.random()-1,i=t*t+e*e;const s=Math.sqrt(-2*Math.log(i)/i);return r.gaussRandomVValue=e*s,r.gaussRandomReturnV=!0,t*s}static randf(t,e){return Math.random()*(e-t)+t}static randi(t,e){return Math.floor(r.randf(t,e))}static randn(t,e){return t+r.gaussRandom()*e}static newArray(t,e=0){if(void 0===t||null===t||isNaN(t))return[];const i=new Float64Array(t);if(0!==e)for(var r=0;r<t;r+=1)i[r]=e;return i}static zeros(t){return r.newArray(t)}static maxmin(t){if(!t||!t.length||0===t.length)return{};const e={maxValue:t[0],minValue:t[0],maxIndex:0,minIndex:0},i=t.length;for(var r=0;r<i;r+=1)t[r]>e.maxValue?(e.maxValue=t[r],e.maxIndex=r):t[r]<e.minValue&&(e.minValue=t[r],e.minIndex=r);return e.delta=e.maxValue-e.minValue,e}static maxValue(t){return r.maxmin(t).maxValue}static maxIndex(t){return r.maxmin(t).maxIndex}static minValue(t){return r.maxmin(t).minValue}static minIndex(t){return r.maxmin(t).minIndex}static posElement(t,e){for(var i=t.length,r=0;r<i;r+=1)if(t[r]===e)return r;return-1}static arrayContains(t,e){return r.posElement(t,e)>-1}static arrayUnique(t){const e=[],i={},r=t.length;for(var s=0;s<r;s+=1)i[t[s]]!==!0&&(e.push(t[s]),i[t[s]]=!0);return e}static randomPermutation(t){const e=[];for(var i=0;i<t;i+=1)e[i]=i;let r=t;for(;r--;){const t=Math.floor(Math.random()*(r+1)),i=e[r];e[r]=e[t],e[t]=i}return e}static weightedSample(t,e){const i=r.randf(0,1);let s=0;for(var a=0;a<t.length;a+=1)if(s+=e[a],i<s)return t[a]}}r.gaussRandomReturnV=!1,r.gaussRandomVValue=0,e.exports=r},{}],24:[function(t,e,i){const r=t("./serializable"),s=t("./utils");class a extends r{constructor(t,e,i,r){if(super(),this.width=t,this.height=e,this.depth=i,this.size=this.width*this.height*this.depth,this.w=s.zeros(this.size),this.dw=s.zeros(this.size),void 0===r)for(var a=Math.sqrt(1/this.size),h=0;h<this.size;h+=1)this.w[h]=s.randn(0,a);else this.setConst(r)}getIndex(t,e,i){return(this.width*e+t)*this.depth+i}get(t,e,i){return this.w[this.getIndex(t,e,i)]}set(t,e,i,r){this.w[this.getIndex(t,e,i)]=r}add(t,e,i,r){this.w[this.getIndex(t,e,i)]+=r}get_grad(t,e,i){return this.dw[this.getIndex(t,e,i)]}set_grad(t,e,i,r){this.dw[this.getIndex(t,e,i)]=r}add_grad(t,e,i,r){this.dw[this.getIndex(t,e,i)]+=r}clearWeights(){for(var t=0;t<this.w.length;t+=1)this.w[t]=0}clearGrads(){for(var t=0;t<this.dw.length;t+=1)this.dw[t]=0}clear(){this.clearWeights(),this.clearGrads()}cloneAndZero(){return new a(this.width,this.height,this.depth,0)}clone(){const t=this.cloneAndZero();for(var e=0;e<this.size;e+=1)t.w[e]=this.w[e];return t}addFrom(t){for(var e=0;e<this.size;e+=1)this.w[e]+=t.w[e]}addFromScaled(t,e){for(var i=0;i<this.size;i+=1)this.w[i]+=e*t.w[i]}setConst(t){for(var e=0;e<this.size;e+=1)this.w[e]=t}flip(){let t=this.clone();for(let e=0;e<this.width;e+=1)for(let i=0;i<this.height;i+=1)for(let r=0;r<this.depth;r+=1)this.set(e,i,r,t.get(this.width-e-1,i,r))}crop(t,e,i){let r;if(i!==this.width||0!==t||0!==e){r=new a(i,i,this.depth,0);for(let s=0;s<i;s+=1)for(let a=0;a<i;a+=1)if(s+t>=0&&s+t<this.width&&a+e>=0&&a+e<this.height)for(let i=0;i<this.depth;i+=1)r.set(s,a,i,this.get(s+t,a+e,i))}else r=this.clone();return r}augment(t,e,i,r=!1){e=e||s.randi(0,this.width-t),i=i||s.randi(0,this.height-t);const a=this.crop(e,i,t);return r&&a.flip(),a}}e.exports=a},{"./serializable":21,"./utils":23}]},{},[1])(1)});