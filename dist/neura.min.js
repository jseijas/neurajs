!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.neura=t()}}(function(){return function t(e,i,s){function r(a,n){if(!i[a]){if(!e[a]){var o="function"==typeof require&&require;if(!n&&o)return o(a,!0);if(h)return h(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[a]={exports:{}};e[a][0].call(u.exports,function(t){var i=e[a][1][t];return r(i?i:t)},u,u.exports,t,e,i,s)}return i[a].exports}for(var h="function"==typeof require&&require,a=0;a<s.length;a++)r(s[a]);return r}({1:[function(t,e,i){e.exports={Utils:t("./utils"),Serializable:t("./serializable"),Layer:t("./layer"),Volume:t("./volume"),ActivationLayer:t("./layers/activation_layer"),ConvolutionalLayer:t("./layers/convolutional_layer"),DropoutLayer:t("./layers/dropout_layer"),FullyConnectedLayer:t("./layers/fully_connected_layer"),InputLayer:t("./layers/input_layer"),LinearLayer:t("./layers/linear_layer"),LRNLayer:t("./layers/lrn_layer"),MaxoutLayer:t("./layers/maxout_layer"),ParentedLayer:t("./layers/parented_layer"),PoolLayer:t("./layers/pool_layer"),RegresionLayer:t("./layers/regression_layer"),ReluLayer:t("./layers/relu_layer"),SigmoidLayer:t("./layers/sigmoid_layer"),SoftmaxLayer:t("./layers/softmax_layer"),SVMLayer:t("./layers/svm_layer"),TanhLayer:t("./layers/tanh_layer"),VectorLayer:t("./layers/vector_layer"),Net:t("./net"),Trainer:t("./trainer"),Neurapp:t("./neurapp")}},{"./layer":2,"./layers/activation_layer":3,"./layers/convolutional_layer":4,"./layers/dropout_layer":5,"./layers/fully_connected_layer":6,"./layers/input_layer":7,"./layers/linear_layer":8,"./layers/lrn_layer":9,"./layers/maxout_layer":10,"./layers/parented_layer":11,"./layers/pool_layer":12,"./layers/regression_layer":13,"./layers/relu_layer":14,"./layers/sigmoid_layer":15,"./layers/softmax_layer":16,"./layers/svm_layer":17,"./layers/tanh_layer":18,"./layers/vector_layer":19,"./net":20,"./neurapp":21,"./serializable":22,"./trainer":23,"./utils":24,"./volume":25}],2:[function(t,e,i){const s=t("./serializable");class r extends s{constructor(t){super(),t=t||{},this.parent=t.parent,this.width=t.width||t.out_sx||t.sx||t.width||1,this.height=t.height||t.out_sy||t.sy||t.height||1,this.depth=t.depth||t.out_depth||t.depth||0,console.log(`Creating layer of type: ${this.getLayerType()}`)}forward(){return this.volume=this.parent.volume,this.volume}backward(){}getParamsAndGrads(){var t=[];if(this.filters){for(var e=0;e<this.depth;e+=1)t.push({params:this.filters[e].w,grads:this.filters[e].dw,l1_decay_mul:this.l1_decay_mul,l2_decay_mul:this.l2_decay_mul});t.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0})}return t}getLayerType(){return this.getClassName().slice(0,-5)}getSize(){return this.width*this.height*this.depth}clone(t){let e,i=JSON.parse(JSON.stringify(this.settings));return t.isJSON?(e={},e.settings=i,e.width=this.width,e.height=this.height,e.depth=this.depth):e=new this.constructor(i),this.volume&&(e.volume=this.clone(t)),e}assign(t,e){this.settings=JSON.parse(JSON.stringify(this.settings)),this.parent=settings.parent,this.width=t.width,this.height=t.height,this.depth=t.depth,this.volume.assign(t.volume)}}e.exports=r},{"./serializable":22}],3:[function(t,e,i){const s=t("./parented_layer");class r extends s{forward(t){this.volume||(this.volume=this.parent.volume.cloneAndZero());const e=this.getSize();for(var i=0;i<e;i+=1)this.volume.w[i]=this.activationFunction(this.parent.volume.w[i]);return this.volume}backward(){const t=this.parent.volume.w.length;for(var e=0;e<t;e+=1)this.parent.volume.dw[e]=this.getBackwardGradient(this.parent.volume.w[e],this.volume.w[e],this.volume.dw[e])}}e.exports=r},{"./parented_layer":11}],4:[function(t,e,i){const s=t("../layer"),r=t("../volume"),h=t("../utils");class a extends s{constructor(t){super(t),t=t||{},this.depth=t.filters,this.horizontalFilterSize=t.horizontalFilterSize||t.filterSize||t.sx,this.verticalFilterSize=t.verticalFilterSize||t.filterSize||t.sy||this.horizontalFilterSize,this.stride=t.stride||1,this.pad=t.pad||0,this.l1_decay_mul=t.l1_decay_mul||0,this.l2_decay_mul=t.l2_decay_mul||1,this.width=Math.floor((this.parent.width+2*this.pad-this.horizontalFilterSize)/this.stride+1),this.height=Math.floor((this.parent.height+2*this.pad-this.verticalFilterSize)/this.stride+1);var e=t.bias_pref||0;this.filters=[];for(var i=0;i<this.depth;i++)this.filters.push(new r(this.horizontalFilterSize,this.verticalFilterSize,this.parent.depth));this.biases=new r(1,1,this.depth,e)}forward(){var t,e,i,s,h,a,n=this.parent.volume;for(this.volume||(this.volume=new r(this.width,this.height,this.depth,0)),t=0;t<this.depth;t+=1){var o,l=this.filters[t],u=this.biases.w[t],d=-this.pad;for(e=0;e<this.height;e+=1){for(o=-this.pad,i=0;i<this.width;i+=1){var f=u;for(s=0;s<l.height;s+=1){var p=d+s;if(p>=0&&p<n.height)for(h=0;h<l.width;h+=1){var c=o+h;if(c>=0&&c<n.width)for(a=0;a<l.depth;a+=1)f+=l.w[(l.width*s+h)*l.depth+a]*n.w[(n.width*p+c)*n.depth+a]}}this.volume.set(i,e,t,f),o+=this.stride}d+=this.stride}}return this.volume}backward(){var t=this.parent.volume;t.dw=h.zeros(t.w.length);for(var e=0;e<this.depth;e+=1)for(var i,s=this.filters[e],r=-this.pad,a=0;a<this.height;a+=1){i=-this.pad;for(var n=0;n<this.width;n+=1){var o=this.volume.get_grad(n,a,e);this.biases.dw[e]+=o;for(var l=0;l<s.height;l+=1){var u=r+l;if(u>=0&&u<t.height)for(var d=0;d<s.width;d+=1){var f=i+d;if(f>=0&&f<t.width)for(var p=0;p<s.depth;p+=1){var c=(t.width*u+f)*t.depth+p,y=(s.width*l+d)*s.depth+p;s.dw[y]+=t.w[c]*o,t.dw[c]+=s.w[y]*o}}}i+=this.stride}r+=this.stride}}}e.exports=a},{"../layer":2,"../utils":24,"../volume":25}],5:[function(t,e,i){const s=t("./parented_layer"),r=t("../utils");class h extends s{constructor(t){super(t),t=t||{},this.drop_prob=t.drop_prob||.5,this.dropped=r.zeros(this.getSize())}forward(t=!1){this.volume=this.parent.volume.clone();var e=this.parent.getSize();if(t)for(var i=0;i<e;i+=1)this.dropped[i]=Math.random()<this.drop_prob,this.dropped[i]&&(this.volume.w[i]=0);else for(var i=0;i<e;i+=1)this.volume.w[i]*=1-this.drop_prob;return this.volume}backward(){var t=this.parent.volume,e=t.w.length;t.dw=r.zeros(e);for(var i=0;i<e;i+=1)this.dropped[i]||(t.dw[i]=this.volume.dw[i])}}e.exports=h},{"../utils":24,"./parented_layer":11}],6:[function(t,e,i){const s=t("./vector_layer"),r=t("../volume"),h=t("../utils");class a extends s{constructor(t){super(t),t=t||{},this.depth=t.neurons||t.num_neurons||t.filters||1,this.l1_decay_mul=t.l1_decay_mul||0,this.l2_decay_mul=t.l2_decay_mul||1,this.biases=new r(1,1,this.depth,t.bias_pref||0),this.filters=[];for(var e=0;e<this.depth;e+=1)this.filters.push(new r(1,1,this.num_inputs))}forward(){var t=this.parent.volume;this.volume||(this.volume=new r(1,1,this.depth,0));for(var e=0;e<this.depth;e+=1){for(var i=0,s=this.filters[e].w,h=0;h<this.num_inputs;h+=1)i+=t.w[h]*s[h];i+=this.biases.w[e],this.volume.w[e]=i}return this.volume}backward(){var t=this.parent.volume;t.dw=h.zeros(t.w.length);for(var e=0;e<this.depth;e+=1){for(var i=this.filters[e],s=this.volume.dw[e],r=0;r<this.num_inputs;r+=1)t.dw[r]+=i.w[r]*s,i.dw[r]+=t.w[r]*s;this.biases.dw[e]+=s}}}e.exports=a},{"../utils":24,"../volume":25,"./vector_layer":19}],7:[function(t,e,i){const s=t("../layer");class r extends s{constructor(t){super(t)}inputVolume(t){this.parent={volume:t}}}e.exports=r},{"../layer":2}],8:[function(t,e,i){const s=t("./activation_layer");class r extends s{activationFunction(t){return t}getBackwardGradient(t,e,i){return i}}e.exports=r},{"./activation_layer":3}],9:[function(t,e,i){const s=t("./parented_layer"),r=t("../utils");class h extends s{constructor(t){super(t),t=t||{},this.k=t.k,this.n=t.n,this.n2=Math.floor(this.n/2),this.alpha=t.alpha,this.beta=t.beta}forward(){var t=this.parent.volume;this.volume=t.cloneAndZero(),this.volumeCache=t.cloneAndZero();for(var e=0;e<t.sx;e+=1)for(var i=0;i<t.sy;i+=1)for(var s=0;s<t.depth;s+=1){for(var r=0,h=Math.max(0,s-this.n2),a=Math.min(s+this.n2,t.depth-1),n=h;n<=a;n+=1){var o=t.get(e,i,n);r+=o*o}r=r*(this.alpha/this.n)+this.k,this.volumeCache.set(e,i,s,r),this.volume.set(e,i,s,t.get(e,i,s)/Math.pow(r,this.beta))}return this.volume}backward(){var t=this.parent.volume;t.dw=r.zeros(t.w.length);for(var e=0;e<t.sx;e+=1)for(var i=0;i<t.sy;i+=1)for(var s=0;s<t.depth;s+=1)for(var h=this.volume.get_grad(e,i,s),a=this.volumeCache.get(e,i,s),n=Math.pow(a,this.beta),o=n*n,l=Math.max(0,s-this.n2),u=Math.min(s+this.n2,t.depth-1),d=l;d<=u;d+=1){var f=t.get(e,i,d),p=-f*this.beta*Math.pow(a,this.beta-1)*this.alpha/this.n*2*f;d===s&&(p+=n),p/=o,p*=h,t.add_grad(e,i,d,p)}}}e.exports=h},{"../utils":24,"./parented_layer":11}],10:[function(t,e,i){const s=t("./parented_layer"),r=t("../volume"),h=t("../utils");class a extends s{constructor(t){super(t),t=t||{},this.group_size=t.group_size||2,this.depth=Math.floor(this.parent.depth/this.group_size),this.switches=h.zeros(this.getSize())}forward(){var t=this.parent.volume;this.volume=new r(this.width,this.height,this.depth,0);for(var e=0,i=0;i<t.sx;i+=1)for(var s=0;s<t.sy;s+=1)for(var h=0;h<this.depth;h+=1){for(var a=h*this.group_size,n=t.get(i,s,a),o=0,l=1;l<this.group_size;l+=1){var u=t.get(i,s,a+l);u>n&&(n=u,o=l)}this.volume.set(i,s,h,n),this.switches[e]=a+o,e+=1}return this.volume}backward(){var t=this.parent.volume;t.dw=h.zeros(t.w.length);for(var e=0,i=0;i<this.volume.sx;i+=1)for(var s=0;s<this.volume.sy;s+=1)for(var r=0;r<this.depth;r+=1)t.set_grad(i,s,this.switches[e],this.volume.get_grad(i,s,r)),e++}}e.exports=a},{"../utils":24,"../volume":25,"./parented_layer":11}],11:[function(t,e,i){const s=t("../layer");class r extends s{constructor(t){super(t),this.width=this.parent.width,this.height=this.parent.height,this.depth=this.parent.depth}}e.exports=r},{"../layer":2}],12:[function(t,e,i){const s=t("../layer"),r=t("../volume");class h extends s{constructor(t){super(t),t=t||{},this.sx=t.sx,this.sy=t.sy||this.sx,this.stride=t.stride||2,this.pad=t.pad||0,this.depth=this.parent.depth,this.width=Math.floor((this.parent.width+2*this.pad-this.sx)/this.stride+1),this.height=Math.floor((this.parent.height+2*this.pad-this.sy)/this.stride+1),this.switch=[];for(var e=this.getSize(),i=0;i<e;i++)this.switch.push({x:-1,y:-1})}forward(t){this.volume?this.volume.clear():this.volume=new r(this.width,this.height,this.depth,0);for(var e=0,i=0;i<this.depth;i+=1)for(var s,h=-this.pad,a=0;a<this.width;a+=1){s=-this.pad;for(var n=0;n<this.height;n+=1){for(var o={},l=0;l<this.sx;l+=1){var u=h+l;if(u>=0&&u<this.parent.volume.width)for(var d=0;d<this.sy;d+=1){var f=s+d;if(f>=0&&f<this.parent.volume.height){var p=this.parent.volume.get(u,f,i);(void 0===o.value||p>o.value)&&(o.value=p,o.x=u,o.y=f)}}}this.switch[e].x=h,this.switch[e].y=s,e+=1,this.volume.set(a,n,i,o.value),s+=this.stride}h+=this.stride}return this.volume}backward(){this.parent.volume.clearGrads();for(var t=0,e=0;e<this.depth;e+=1)for(var i=0;i<this.width;i+=1)for(var s=0;s<this.width;s+=1)this.parent.volume.add_grad(this.switch[t].x,this.switch[t].y,e,this.volume.get_grad(i,s,e)),t+=1}}e.exports=h},{"../layer":2,"../volume":25}],13:[function(t,e,i){const s=t("./vector_layer"),r=t("../utils");class h extends s{backward(t){var e=this.parent.volume;e.dw=r.zeros(e.w.length);var i=0,s=this.depth;"number"==typeof t&&(t=[t],s=1);for(var h=0;h<s;h+=1){var a=e.w[h]-t[h];e.dw[h]=a,i+=.5*a*a}return i}}e.exports=h},{"../utils":24,"./vector_layer":19}],14:[function(t,e,i){const s=t("./activation_layer");class r extends s{activationFunction(t){return t<0?0:t}getBackwardGradient(t,e,i){return e<=0?0:i}}e.exports=r},{"./activation_layer":3}],15:[function(t,e,i){const s=t("./activation_layer");class r extends s{activationFunction(t){return 1/(1+Math.exp(-t))}getBackwardGradient(t,e,i){return e*(1-e)*i}}e.exports=r},{"./activation_layer":3}],16:[function(t,e,i){const s=t("./vector_layer"),r=t("../volume"),h=t("../utils");class a extends s{forward(){var t=this.parent.volume.w;this.volume?this.volume.clear():this.volume=new r(1,1,this.depth,0);for(var e=t[0],i=1;i<this.depth;i+=1)t[i]>e&&(e=t[i]);this.es||(this.es=h.zeros(this.depth));for(var s=0,i=0;i<this.depth;i+=1)this.es[i]=Math.exp(t[i]-e),s+=this.es[i];for(var i=0;i<this.depth;i+=1)this.es[i]/=s,this.volume.w[i]=this.es[i];return this.volume}backward(t){this.parent.volume.clearGrads();for(var e=0;e<this.depth;e+=1)this.parent.volume.dw[e]=this.es[e]-(e===t?1:0);return-Math.log(this.es[t])}}e.exports=a},{"../utils":24,"../volume":25,"./vector_layer":19}],17:[function(t,e,i){const s=t("./vector_layer");class r extends s{backward(t){for(var e=this.parent.volume.w[t],i=0,s=0;s<this.depth;s+=1)if(t!==s){var r=this.parent.volume[s]-e+1;r>0&&(this.parent.volume.dw[s]+=1,this.parent.volume.dw[t]-=1,i+=r)}return i}}e.exports=r},{"./vector_layer":19}],18:[function(t,e,i){const s=t("./activation_layer");class r extends s{activationFunction(t){return Math.tanh(t)}getBackwardGradient(t,e,i){return(1-e*e)*i}}e.exports=r},{"./activation_layer":3}],19:[function(t,e,i){const s=t("../layer");class r extends s{constructor(t){super(t),t=t||{},this.width=1,this.height=1,this.num_inputs=this.parent.getSize(),this.depth=this.num_inputs}}e.exports=r},{"../layer":2}],20:[function(t,e,i){const s=t("./layers/convolutional_layer"),r=t("./layers/dropout_layer"),h=t("./layers/fully_connected_layer"),a=t("./layers/input_layer"),n=t("./layers/linear_layer"),o=t("./layers/lrn_layer"),l=t("./layers/maxout_layer"),u=t("./layers/pool_layer"),d=t("./layers/regression_layer"),f=t("./layers/relu_layer"),p=t("./layers/sigmoid_layer"),c=t("./layers/softmax_layer"),y=t("./layers/svm_layer"),m=t("./layers/tanh_layer"),v=t("./serializable");class g extends v{constructor(){super(),this.layers=[],this.layerClasses={},this.registerLayers()}registerLayer(t,e){this.layerClasses[t]=e}registerLayers(){this.registerLayer("conv",s),this.registerLayer("dropout",r),this.registerLayer("fc",h),this.registerLayer("input",a),this.registerLayer("linear",n),this.registerLayer("lrn",o),this.registerLayer("maxout",l),this.registerLayer("pool",u),this.registerLayer("regression",d),this.registerLayer("relu",f),this.registerLayer("sigmoid",p),this.registerLayer("softmax",c),this.registerLayer("svm",y),this.registerLayer("tanh",m)}createLayer(t){return new this.layerClasses[t.type](t)}addPrelayer(t){"softmax"!==t.type&&"svm"!==t.type&&"regression"!==t.type||this.addLayer({type:"fc",num_neurons:t.neurons||t.num_classes||t.num_neurons})}addPostlayer(t){if(t.activation){let e={type:t.activation};"maxout"===t.activation&&(e.group_size=t.group_size||2),this.addLayer(e)}t.drop_prob&&"dropout"!==t.type&&this.addLayer({type:"dropout",drop_prob:t.drop_prob})}addLayer(t){this.addPrelayer(t),"fc"!==t.type&&"conv"!==t.type||void 0!==t.bias_pref||(t.bias_pref="relu"===t.activation?.1:0),t.parent=this.layers.length>0?this.layers[this.layers.length-1]:void 0,this.layers.push(this.createLayer(t)),this.addPostlayer(t)}makeLayers(t){this.layers=[];for(var e=0;e<t.length;e+=1)this.addLayer(t[e])}build(t){let e=[];t.input&&(t.input.type="input",e.push(t.input));for(let i=0;i<t.layers.length;i+=1){let s=t.layers[i];s.iterate||(s.iterate=1),s.type||(s.type="fc");for(let t=0;t<s.iterate;t+=1)e.push(s)}t.output&&e.push(t.output),this.makeLayers(e)}getInputLayer(){return this.layers[0]}forward(t,e=!1){this.layers[0].inputVolume(t);for(var i=0;i<this.layers.length;i+=1)this.layers[i].forward(e);return this.layers[this.layers.length-1].volume}backward(t){const e=this.layers[this.layers.length-1].backward(t);for(var i=this.layers.length-2;i>=0;i-=1)this.layers[i].backward();return e}getPrediction(){let t=this.layers[this.layers.length-1].volume.w,e=t[0],i=0;for(var s=1;s<t.length;s+=1)t[s]>e&&(e=t[s],i=s);return i}getParamsAndGrads(){for(var t=[],e=0;e<this.layers.length;e+=1)for(var i=this.layers[e].getParamsAndGrads(),s=0;s<i.length;s+=1)t.push(i[s]);return t}clone(t){const e=t.isJSON?{}:new g;for(let i=0;i<this.layers.length;i+=1)e.layers.add(this.layers[i].clone(t));return e}assign(t,e){this.layers=[];for(let e=0;e<t.layers.length;e+=1){let i=t.layers[e];e>0&&(i.settings.parent=this.layers[e-1]);let s=createLayer(i.settings);s.volume.assign(i.volume),this.layers.add(s)}}}e.exports=g},{"./layers/convolutional_layer":4,"./layers/dropout_layer":5,"./layers/fully_connected_layer":6,"./layers/input_layer":7,"./layers/linear_layer":8,"./layers/lrn_layer":9,"./layers/maxout_layer":10,"./layers/pool_layer":12,"./layers/regression_layer":13,"./layers/relu_layer":14,"./layers/sigmoid_layer":15,"./layers/softmax_layer":16,"./layers/svm_layer":17,"./layers/tanh_layer":18,"./serializable":22}],21:[function(t,e,i){const s=t("./net"),r=t("./trainer");class h{constructor(){}build(t){this.net=new s,this.net.build(t.layers),t.trainer?this.trainer=new r(this.net,t.trainer):this.trainer=new r(this.net,{type:"adadelta",learning_rate:.01,momentum:.9,batch_size:5,l2_decay:0})}}e.exports=h},{"./net":20,"./trainer":23}],22:[function(t,e,i){class s{clone(t,e){}assign(t){}toJSON(t){t.isJSON=!0;const e=this.clone(t);return e.className=this.getClassName(),JSON.stringify(e)}fromJSON(t){this.assign(JSON.parse(json,t))}getClassName(){return this.constructor.name}}e.exports=s},{}],23:[function(t,e,i){const s=t("./utils");class r{constructor(t,e){this.net=t,e=e||{},this.learning_rate=e.learning_rate||.01,this.l1_decay=e.l1_decay||0,this.l2_decay=e.l2_decay||0,this.batch_size=e.batch_size||1,this.methodName=e.method||"sgd",this.momentum=e.momentum||.9,this.ro=e.ro||.95,this.eps=e.eps||1e-6,this.iteration=0,this.gsum=[],this.xsum=[],this.initializeMethods()}initializeMethods(){this.methods={},this.methods.adam=this.adamMethod.bind(this),this.methods.adagrad=this.adagradMethod.bind(this),this.methods.windowgrad=this.windowgradMethod.bind(this),this.methods.adadelta=this.adadeltaMethod.bind(this),this.methods.nesterov=this.nesterovMethod.bind(this),this.methods.sgd=this.sgdMethod.bind(this)}getMethod(){return this.methods[this.methodName]||this.methods.sgd}adamMethod(t,e,i){var s=this.gsum[t],r=this.xsum[t];s[e]=s[e]*this.beta1+(1-this.beta1)*i,r[e]=r[e]*this.beta2+(1-this.beta2)*i*i;var h=s[e]/(1-Math.pow(this.beta1,this.iteration)),a=r[e]/(1-Math.pow(this.beta2,this.iteration));return-this.learning_rate*h/(Math.sqrt(a)+this.eps)}adagradMethod(t,e,i){var s=this.gsum[t];return s[e]=s[e]+i*i,this.learning_rate/Math.sqrt(s[e]+this.eps)*i}windowgradMethod(t,e,i){var s=this.gsum[t];return s[e]=this.ro*s[e]+(1-this.ro)*i*i,this.learning_rate/Math.sqrt(s[e]+this.eps)*i}adadeltaMethod(t,e,i){var s=this.gsum[t],r=this.xsum[t];s[e]=this.ro*s[e]+(1-this.ro)*i*i;var h=-Math.sqrt((r[e]+this.eps)/(s[e]+this.eps))*i;return r[e]=this.ro*r[e]+(1-this.ro)*h*h,h}nesterovMethod(t,e,i){var s=this.gsum[t];return s[e]=s[e]*this.momentum+this.learning_rate*i,this.momentum*s[e]-(1+this.momentum)*s[e]}sgdMethod(t,e,i){if(this.momentum>0){var s=this.gsum[t],r=this.momentum*s[e]-this.learning_rate*i;return s[e]=r,r}return-this.learning_rate*i}propagate(t,e,i){let s=performance.now();this.net.forward(t,!0),i.fwd_time=performance.now()-s,s=performance.now(),i.cost_loss=this.net.backward(e),i.bwd_time=performance.now()-s}initializeSums(t){const e="adadelta"===this.methodName||"adam"===this.methodName;if(0===this.gsum.length&&("sgd"!=this.methodName||this.momentum>0))for(var i=0;i<t.length;i+=1)this.gsum.push(s.zeros(t[i].params.length)),e&&this.xsum.push(s.zeros(t[i].params.length))}iterate(t,e,i){for(var s=0;s<t.length;s+=1)for(var r=t[s],h=r.params,a=r.grads,n=this.l1_decay*(r.l1_decay_mul||1),o=this.l2_decay*(r.l2_decay_mul||1),l=h.length,u=0;u<l;u+=1){i.l1_decay_loss+=n*Math.abs(h[u]),i.l2_decay_loss+=o*h[u]*h[u]/2;var d=(n*(h[u]>0?1:-1)+o*h[u]+a[u])/this.batch_size;h[u]+=e(s,u,d),a[u]=0}}train(t,e){var i={l1_decay_loss:0,l2_decay_loss:0};this.propagate(t,e,i);var s=this.getMethod();if(this.iteration+=1,this.iteration%this.batch_size==0){var r=this.net.getParamsAndGrads();this.initializeSums(r),this.iterate(r,s,i)}return i.loss=i.cost_loss+i.l1_decay_loss+i.l2_decay_loss,i}}e.exports=r},{"./utils":24}],24:[function(t,e,i){class s{static gaussRandom(){if(s.gaussRandomReturnV)return s.gaussRandomReturnV=!1,s.gaussRandomVValue;let t,e,i=0;for(;0===i||i>1;)t=2*Math.random()-1,e=2*Math.random()-1,i=t*t+e*e;const r=Math.sqrt(-2*Math.log(i)/i);return s.gaussRandomVValue=e*r,s.gaussRandomReturnV=!0,t*r}static randf(t,e){return Math.random()*(e-t)+t}static randi(t,e){return Math.floor(s.randf(t,e))}static randn(t,e){return t+s.gaussRandom()*e}static newArray(t,e=0){if(void 0===t||null===t||isNaN(t))return[];const i=new Float64Array(t);if(0!==e)for(var s=0;s<t;s+=1)i[s]=e;return i}static zeros(t){return s.newArray(t)}static maxmin(t){if(!t||!t.length||0===t.length)return{};const e={maxValue:t[0],minValue:t[0],maxIndex:0,minIndex:0},i=t.length;for(var s=0;s<i;s+=1)t[s]>e.maxValue?(e.maxValue=t[s],e.maxIndex=s):t[s]<e.minValue&&(e.minValue=t[s],e.minIndex=s);return e.delta=e.maxValue-e.minValue,e}static maxValue(t){return s.maxmin(t).maxValue}static maxIndex(t){return s.maxmin(t).maxIndex}static minValue(t){return s.maxmin(t).minValue}static minIndex(t){return s.maxmin(t).minIndex}static posElement(t,e){for(var i=t.length,s=0;s<i;s+=1)if(t[s]===e)return s;return-1}static arrayContains(t,e){return s.posElement(t,e)>-1}static arrayUnique(t){const e=[],i={},s=t.length;for(var r=0;r<s;r+=1)i[t[r]]!==!0&&(e.push(t[r]),i[t[r]]=!0);return e}static randomPermutation(t){const e=[];for(var i=0;i<t;i+=1)e[i]=i;let s=t;for(;s--;){const t=Math.floor(Math.random()*(s+1)),i=e[s];e[s]=e[t],e[t]=i}return e}static weightedSample(t,e){const i=s.randf(0,1);let r=0;for(var h=0;h<t.length;h+=1)if(r+=e[h],i<r)return t[h]}}s.gaussRandomReturnV=!1,s.gaussRandomVValue=0,e.exports=s},{}],25:[function(t,e,i){const s=t("./serializable"),r=t("./utils");class h extends s{constructor(t,e,i,s){if(super(),this.width=t,this.height=e,this.depth=i,this.size=this.width*this.height*this.depth,this.w=r.zeros(this.size),this.dw=r.zeros(this.size),void 0===s)for(var h=Math.sqrt(1/this.size),a=0;a<this.size;a+=1)this.w[a]=r.randn(0,h);else this.setConst(s)}getIndex(t,e,i){return(this.width*e+t)*this.depth+i}get(t,e,i){return this.w[this.getIndex(t,e,i)]}set(t,e,i,s){this.w[this.getIndex(t,e,i)]=s}add(t,e,i,s){this.w[this.getIndex(t,e,i)]+=s}get_grad(t,e,i){return this.dw[this.getIndex(t,e,i)]}set_grad(t,e,i,s){this.dw[this.getIndex(t,e,i)]=s}add_grad(t,e,i,s){this.dw[this.getIndex(t,e,i)]+=s}clearWeights(){for(var t=0;t<this.w.length;t+=1)this.w[t]=0}clearGrads(){for(var t=0;t<this.dw.length;t+=1)this.dw[t]=0}clear(){this.clearWeights(),this.clearGrads()}cloneAndZero(){return new h(this.width,this.height,this.depth,0)}clone(t){let e;t.isJSON?(e={width:this.width,height:this.height,depth:this.depth},e.w=r.zeros(this.size),e.dw=r.zeros(this.size)):e=this.cloneAndZero();for(var i=0;i<this.size;i+=1)e.w[i]=this.w[i];if(t.isSnapshot)for(var i=0;i<this.size;i+=1)e.dw[i]=this.dw[i];else delete e.dw;return e}assign(t,e){this.width=t.width,this.height=t.height,this.depth=t.depth,this.size=this.width*this.height*this.depth,this.w=r.zeros(this.size),this.dw=r.zeros(this.size);for(var i=0;i<this.size;i+=1)this.w[i]=t.w[i];if(t.dw)for(var i=0;i<this.size;i+=1)this.dw[i]=t.dw[i]}addFrom(t){for(var e=0;e<this.size;e+=1)this.w[e]+=t.w[e]}addFromScaled(t,e){for(var i=0;i<this.size;i+=1)this.w[i]+=e*t.w[i]}setConst(t){for(var e=0;e<this.size;e+=1)this.w[e]=t}flip(){let t=this.clone();for(let e=0;e<this.width;e+=1)for(let i=0;i<this.height;i+=1)for(let s=0;s<this.depth;s+=1)this.set(e,i,s,t.get(this.width-e-1,i,s))}crop(t,e,i){let s;if(i!==this.width||0!==t||0!==e){s=new h(i,i,this.depth,0);for(let r=0;r<i;r+=1)for(let h=0;h<i;h+=1)if(r+t>=0&&r+t<this.width&&h+e>=0&&h+e<this.height)for(let i=0;i<this.depth;i+=1)s.set(r,h,i,this.get(r+t,h+e,i))}else s=this.clone();return s}augment(t,e,i,s=!1){e=e||r.randi(0,this.width-t),i=i||r.randi(0,this.height-t);const h=this.crop(e,i,t);return s&&h.flip(),h}}e.exports=h},{"./serializable":22,"./utils":24}]},{},[1])(1)});